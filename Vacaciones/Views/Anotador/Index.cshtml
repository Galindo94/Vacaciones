@model Vacaciones.Models.Persona
<!DOCTYPE html>

<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <script>

        $(document).ready(function () {

            //Creacion de la grid
            $("#rowSelection").kendoGrid({
                dataSource: {
                    data: "",
                    pageSize: 5
                },
                selectable: "single",
                pageable: {
                    buttonCount: 5
                },
                scrollable: false,
                navigatable: true,
                columns: [
                    {
                        field: "Cedula",
                        title: "Cedula"
                    },
                    {
                        field: "NumeroDias",
                        title: "Numero de dias"
                    },
                    {
                        field: "FechaInicio",
                        title: "Fecha de inicio"
                    },
                    {
                        field: "FechaFin",
                        title: "Fecha de fin"
                    }
                ]
            });


            //Validacion del campo numero de dias en pantalla principal
            $("#NumDias0").focusout(function () {
                if ($("#NumDias0").val() != '') {
                    $.getJSON("/Anotador/ValidarCantidadDias", { NumeroDias: $("#NumDias0").val() }, function (respuesta) {
                        if (respuesta.Codigo == 1 || respuesta.Codigo == 2) {
                            swal.fire({
                                title: "Advertencia!",
                                text: respuesta.Mensaje,
                                type: 'warning',
                                confirmButtonText: "Ok",
                                confirmButtonColor: '#00AFF0',
                                allowOutsideClick: false,
                                allowEscapeKey: false
                            }).then((result) => {
                                if (result.value) {
                                    setTimeout(function () {
                                        $("#NumDias0").val('');
                                        $("#NumDias0").focus();
                                    }, 500)
                                }
                            });
                        }
                    })
                }
            });


            //Ventana Modal
            //Validacion del campo numero de dias
            $("#NumDias1").focusout(function () {
                if ($("#NumDias1").val() != '') {
                    $.getJSON("/Anotador/ValidarCantidadDias", { NumeroDias: $("#NumDias1").val() }, function (respuesta) {
                        if (respuesta.Codigo == 1 || respuesta.Codigo == 2) {
                            swal.fire({
                                title: "Advertencia!",
                                text: respuesta.Mensaje,
                                type: 'warning',
                                confirmButtonText: "Ok",
                                confirmButtonColor: '#00AFF0',
                                allowOutsideClick: false,
                                allowEscapeKey: false
                            }).then((result) => {
                                if (result.value) {
                                    setTimeout(function () {
                                        $("#NumDias1").val('');
                                        $("#NumDias1").focus();
                                    }, 500)
                                }
                            });
                        }
                    })
                }
            });


            //Evitar que se cierre la modal cuando se da click por fuera de ella
            $("#btnOtrosColaboradoresModal").click(function () {
                if ($("#txtCedulaOtros").val() != '') {

                    var exis = false;

                    $($('#rowSelection').data("kendoGrid").dataSource.data()).each(function (index) {
                        if (this.Cedula == $("#txtCedulaOtros").val()) {
                            exis = true;
                        }
                    });


                    if (!exis) {
                        $("#ModalOtrosColaboradores").modal({
                            backdrop: 'static'
                        });
                    }
                    else {
                        swal.fire({
                            title: "Advertencia!",
                            text: "El usuario ya se encuentra en la lista",
                            type: 'warning',
                            allowOutsideClick: false,
                            allowEscapeKey: false
                        });
                    }

                }
                else {
                    swal.fire({
                        title: "Advertencia!",
                        text: "Debe ingresar una cedula",
                        type: 'warning',
                        allowOutsideClick: false,
                        allowEscapeKey: false
                    });
                }
            });

            //Evento del boton aregar dentro de la ventana modal
            $('#btnAgregar').click(function () {
                $.post("../Anotador/AgregarEmpleado", { Cedula: $("#txtCedulaOtros").val(), NumeroDias: $("#NumDias1").val(), FechaInicio: $("#kendocalendar_2").val(), FechaFin: $("#kendocalendar_3").val(), DataActual: JSON.stringify($('#rowSelection').data("kendoGrid").dataSource.data()) }, function (d) {
                    if (d.Codigo == 2) {
                        swal.fire({
                            title: "Advertencia!",
                            text: d.Mensaje,
                            type: 'warning',
                            allowOutsideClick: false,
                            allowEscapeKey: false
                        });
                    }
                    else {
                        $('#rowSelection').data("kendoGrid").dataSource.data(d.Resultado.Data);
                        swal.fire({
                            title: "Buen trabajo!",
                            text: d.Mensaje,
                            type: 'success',
                            allowOutsideClick: false,
                            allowEscapeKey: false
                        });
                    }
                });
            });

            //Se limpian los valores de la ventana modal cuando se cierran
            $('#ModalOtrosColaboradores').on('hidden.bs.modal', function (e) {
                $("#kendocalendar_2").data("kendoDatePicker").value(null);
                $("#kendocalendar_3").data("kendoDatePicker").value(null);
                $("#NumDias1").val('');
                $("#txtCedulaOtros").val('');
            });


        });

    </script>

</head>
<body>
    <div class="jumbotron">

        <div class="jumbotron-cuerpo">
            @Html.Partial("_EncabezadoEscenario")
            @Html.Partial("_CuerpoEscenario")
            @Html.Partial("_OtrosColaboradoresEscenario")
            @Html.Partial("_GridEmpleados")
        </div>

        <div class="modal fade  bd-example-modal-lg " id="ModalOtrosColaboradores" role="dialog">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-body">
                        <div class="jumbotron-cuerpo">
                            @Html.Partial("_ModalAnotadores")
                        </div>
                        <div class="jumbotron-cuerpo center">
                            <button id="btnAgregar" type="button" class="btn btn-light" data-dismiss="modal">Agregar</button>
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>